.TH TAGGER 1 "January 2026" "tagger 1.23.2" "User Commands"
.SH NAME
tagger \- Audio file tag and filename manager
.SH SYNOPSIS
.B tagger
[\fB\-e\fR|\fB\-\-execute\fR] [\fB\-o\fR \fIOUTPUT\fR] [\fB\-\-no\-color\fR] [\fB\-\-prefer\-filename\fR] [\fIYAML_FILE\fR]
.br
.B tagger
{\fB\-v\fR|\fB\-\-version\fR}
.br
.B tagger
{\fB\-h\fR|\fB\-\-help\fR}
.SH DESCRIPTION
.B tagger
is an audio file tag and filename manager that supports MP3 and M4A files.
.PP
.B Tag Management Mode
- Generate YAML configuration from audio files, apply tags from YAML, and synchronize filenames with metadata.
.SH OPTIONS
.SS "General Options"
.TP
.BR \-e ", " \-\-execute
Execute changes (default is dry-run mode). Without this flag, tagger will only show what would be changed.
.TP
.BR \-o ", " \-\-output " " \fIOUTPUT\fR
Output YAML file name when generating (default: tagger.yaml).
.TP
.BR \-\-no\-color
Disable colored output. Useful for scripts or non-TTY environments.
.TP
.BR \-\-prefer\-filename
Prefer metadata from filenames over embedded tags when generating YAML (non-interactive mode). Skips the interactive prompt for conflict resolution.
.TP
.BR \-v ", " \-\-version
Display version information and exit.
.TP
.BR \-h ", " \-\-help
Display help message and exit.
.SH TAG MANAGEMENT MODE
.SS "Workflow Overview"
Tag management follows a declarative approach using YAML configuration:
.PP
.B 1. Generate YAML from current state
.br
.RS
$ tagger --execute
.RE
.PP
This scans all .mp3 and .m4a files in the current directory, reads their metadata, and creates tagger.yaml with the current state.
.PP
.B 2. Edit YAML to desired state
.br
.RS
Edit tagger.yaml to define the desired tags and filenames.
.RE
.PP
.B 3. Preview changes
.br
.RS
$ tagger tagger.yaml
.RE
.PP
Shows differences between current state and YAML (dry-run mode).
.PP
.B 4. Apply changes
.br
.RS
$ tagger --execute tagger.yaml
.RE
.PP
Applies tags and renames files to match YAML configuration.
.SS "YAML Configuration Format"
.PP
The YAML file has two main sections:
.PP
.B defaults
(optional) - Common metadata applied to all files:
.RS
.nf
defaults:
  album: "Album Name"
  albumartist: "Artist Name"
  genre: "Electronic"
  year: 2025
  artwork: "cover.jpg"
  compilation: true
  label: "Label Name"
  bandcamp_id: "123456"
  disc: 1
.fi
.RE
.PP
.B files
(required) - List of individual file configurations:
.RS
.nf
files:
  - filename: "01 Track One.mp3"
    track: 1
    artist: "Artist Name"
    title: "Track One"
  - filename: "02 Track Two.mp3"
    track: 2
    artist: "Artist Name"
    title: "Track Two"
.fi
.RE
.PP
File-specific values override defaults. The
.I filename
field is required and identifies the file to modify.
.SS "Filename Parsing Patterns"
.PP
When tags are missing or --prefer-filename is used, tagger automatically parses metadata from filenames using these patterns (in order of precedence):
.PP
.B 1. Bandcamp format:
.br
.RS
Label - Artist - Title [ID].mp3
.RE
.PP
.B 2. Track with dot + artist + title:
.br
.RS
1. Artist - Title.mp3
.br
Track number uses dot notation.
.RE
.PP
.B 3. Track + artist + title:
.br
.RS
01 Artist - Title.mp3
.br
Track number with 1+ leading zeros.
.RE
.PP
.B 4. Track + title (no artist):
.br
.RS
01  - Title.mp3
.br
Note: two spaces before hyphen when no artist.
.RE
.PP
.B 5. Track + title (no separator):
.br
.RS
01 Title.mp3
.RE
.PP
.B 6. Artist + title (no track):
.br
.RS
Artist - Title.mp3
.RE
.PP
.B 7. Title only:
.br
.RS
Title.mp3
.RE
.PP
All patterns support flexible spacing (1+ spaces around separators).
.SS "Filename Generation Rules"
.PP
Tagger generates filenames from tags using these rules:
.PP
.B With track and artist:
.br
.RS
01 Artist - Title.mp3
.RE
.PP
.B With track, no artist:
.br
.RS
01  - Title.mp3
.br
Note: two spaces before hyphen.
.RE
.PP
.B With artist, no track:
.br
.RS
Artist - Title.mp3
.RE
.PP
.B Title only:
.br
.RS
Title.mp3
.RE
.PP
Track numbers are zero-padded based on the maximum track number (minimum 2 digits). For example, if the highest track is 99, all tracks use 2 digits (01-99). If the highest is 100, all use 3 digits (001-100).
.SS "Tag Comparison and Updates"
.PP
Tagger uses smart comparison to minimize unnecessary writes:
.PP
.B 1. Only specified fields are compared
.br
Fields not present in YAML are ignored (won't be modified in the file).
.PP
.B 2. Artwork comparison
.br
When YAML specifies an artwork file, tagger compares SHA256 hashes of embedded and external artwork to avoid redundant updates.
.PP
.B 3. Batch updates
.br
All tag updates for a file happen in a single write operation to preserve file integrity.
.SS "File Conversion"
.PP
Tagger automatically converts .aac files to .m4a format using ffmpeg when found:
.RS
.IP \(bu 3
Lossless container conversion (no re-encoding)
.IP \(bu 3
Original .aac file is removed after successful conversion
.IP \(bu 3
Conversion happens before tag operations
.RE
.SS "Artwork Auto-Fetching"
.PP
Tagger automatically downloads and embeds artwork from YouTube and Bandcamp when generating YAML files.
.PP
.B YouTube Thumbnails:
.PP
When files have YouTube URLs in the comment field (e.g., files named
.I "Artist - Song [VIDEO_ID].mp3"
), tagger:
.RS
.IP 1. 4
Extracts the YouTube video ID from the filename
.IP 2. 4
Stores the full YouTube URL in the comment tag
.IP 3. 4
Downloads the video thumbnail using yt-dlp
.IP 4. 4
Optionally crops to square aspect ratio (based on
.B --thumbnail-crop
)
.IP 5. 4
Saves as
.B cover.jpg
(single file) or
.B youtube_VIDEO_ID.jpg
(multiple files)
.IP 6. 4
Sets the artwork field in YAML to reference the thumbnail
.RE
.PP
.B Bandcamp Artwork:
.PP
When files have Bandcamp URLs in the comment field, tagger:
.RS
.IP 1. 4
Detects the Bandcamp URL in the comment tag
.IP 2. 4
Downloads the album/track artwork using yt-dlp
.IP 3. 4
Optionally crops to square aspect ratio (based on
.B --thumbnail-crop
)
.IP 4. 4
Saves as
.B cover.jpg
(single file) or
.B bandcamp_{label}_{album}.jpg
(multiple albums)
.IP 5. 4
Sets the artwork field in YAML to reference the artwork
.RE
.PP
Supported Bandcamp URL formats:
.RS
.IP \(bu 2
https://LABEL.bandcamp.com/album/ALBUM-SLUG
.IP \(bu 2
https://LABEL.bandcamp.com/track/TRACK-SLUG
.RE
.PP
.B Setting URLs in YAML:
.PP
You can set YouTube or Bandcamp URLs in the comment field:
.RS
.nf
defaults:
  comment: https://label.bandcamp.com/album/album-name

files:
  - filename: "Track.mp3"
    comment: https://www.youtube.com/watch?v=VIDEO_ID
.fi
.RE
.PP
.B Thumbnail Cropping Options:
.PP
Use the
.B --thumbnail-crop
option to control artwork cropping:
.RS
.IP \(bu 2
.B auto
(default) - Ask for each thumbnail whether to crop to square
.IP \(bu 2
.B square
- Always crop to square (center crop)
.IP \(bu 2
.B none
- Keep original aspect ratio
.RE
.PP
.B Features:
.RS
.IP \(bu 3
Smart deduplication (same URL downloads only once)
.IP \(bu 3
Graceful degradation (works without yt-dlp for YouTube)
.IP \(bu 3
Won't override existing artwork
.IP \(bu 3
Same artwork shared across files from same album
.RE
.SH EXAMPLES
.SS "Tag Management Examples"
.PP
.B Generate YAML from current directory:
.RS
$ tagger --execute
.RE
.PP
.B Apply tags from YAML (dry-run):
.RS
$ tagger tagger.yaml
.RE
.PP
.B Apply tags from YAML (execute):
.RS
$ tagger --execute tagger.yaml
.RE
.PP
.B Generate YAML preferring filenames over tags:
.RS
$ tagger --execute --prefer-filename
.RE
.PP
.B Show differences between current state and YAML:
.RS
$ tagger
.RE
.PP
(When tagger.yaml exists, default mode is diff)
.SH SUPPORTED FILE FORMATS
.PP
.B Audio Formats (Tag Management):
.RS
.IP \(bu 3
.B .mp3
- MPEG-1/2 Layer 3 with ID3v2 tags
.IP \(bu 3
.B .m4a
- MPEG-4 Audio with MP4 tags
.IP \(bu 3
.B .aac
- Raw AAC (automatically converted to .m4a)
.RE
.PP
.B Audio Formats (Segmentation):
.RS
.IP \(bu 3
Any format supported by ffmpeg/audioread
.IP \(bu 3
Tested: .mp3, .m4a, .aac, .wav, .flac, .ogg
.RE
.PP
.B Artwork Formats:
.RS
.IP \(bu 3
.jpg, .jpeg (MIME: image/jpeg)
.IP \(bu 3
.png (MIME: image/png)
.RE
.SH FILES
.TP
.B tagger.yaml
Default YAML configuration file for tag management.
.TP
.B *.cue
.TP
.B *.aac
AAC files created for mp3DirectCut compatibility when converting from M4A/MP4 format (cached).
.SH ENVIRONMENT
.TP
.TP
.TP
.TP
.SH DEPENDENCIES
.PP
.B Core Dependencies (Always Required):
.RS
.IP \(bu 3
mutagen >= 1.45.0 - Audio tag manipulation
.IP \(bu 3
PyYAML >= 6.0 - YAML configuration handling
.IP \(bu 3
pydantic >= 2.0.0 - YAML schema validation
.RE
.PP
.PP
.PP
.B External Dependencies:
.RS
.IP \(bu 3
ffmpeg - Audio/video processing (required for .aac conversion)
.IP \(bu 3
ffprobe - Format detection (bundled with ffmpeg)
.IP \(bu 3
.RE
.SH EXIT STATUS
.TP
.B 0
Success
.TP
.B 1
General error (invalid arguments, file not found, etc.)
.SH DIAGNOSTICS
.PP
.B Common Errors and Solutions:
.PP
.B "Error: mutagen is not installed"
.RS
Install mutagen: pip install mutagen
.RE
.PP
.B "Error: pydantic is not installed"
.RS
Install pydantic: pip install pydantic
.RE
.PP
.B "Error: librosa is not installed"
.RS
Install librosa and dependencies: pip install librosa
.RE
.PP
.B "Warning: ffmpeg not found"
.RS
Install ffmpeg via package manager (brew install ffmpeg on macOS)
.RE
.PP
.B "YAML validation failed"
.RS
Common issues:
.IP \(bu 3
Typo in field names (e.g., 'default' instead of 'defaults')
.IP \(bu 3
Wrong data type (e.g., year as string instead of number)
.IP \(bu 3
Missing required fields (filename)
.IP \(bu 3
Invalid year range (must be 1900-2100)
.IP \(bu 3
Invalid track/disc numbers (must be positive)
.RE
.PP
.B "scipy.sparse.linalg.ArpackNoConvergence"
.RS
Sparse matrix eigenvalue computation failed (very rare). Workaround: Use smaller chunk size or reduce k parameter in code.
.RE
.SH SHELL COMPLETION
.PP
When installed via Homebrew, shell completions are automatically set up for Bash, Zsh, and Fish shells.
Completions provide intelligent tab-completion for command-line options, file types.
.PP
.B Bash
.RS
Completions are automatically loaded if bash-completion is installed via Homebrew.
.RE
.PP
.B Zsh
.RS
Completions are automatically loaded. Ensure
.I compinit
is called in your
.I .zshrc
configuration file.
.RE
.PP
.B Fish
.RS
Completions are automatically loaded by the Fish shell.
.RE
.PP
.B Features
.RS
.IP \(bu 3
Command-line option completion (--execute, etc.)
.IP \(bu 3
Context-aware file completion:
.RS
.IP \(bu 3
YAML files for positional arguments and -o/--output
.IP \(bu 3
.IP \(bu 3
.IP \(bu 3
.RE
.IP \(bu 3
.RE
.SH BUGS
.PP
Report bugs at: https://github.com/delphinus/homebrew-tagger/issues
.SH AUTHOR
.PP
Written by delphinus.
.SH COPYRIGHT
.PP
Copyright Â© 2025 delphinus. Licensed under the MIT License.
.SH SEE ALSO
.PP
.BR mutagen (1),
.BR ffmpeg (1),
.BR mp3DirectCut (1)
.PP
Project homepage: https://github.com/delphinus/homebrew-tagger
.PP
AcoustID: https://acoustid.org
.PP
MusicBrainz: https://musicbrainz.org
